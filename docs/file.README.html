<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><table>
  <thead>
    <tr>
      <th>üìç NOTE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>RubyGems (the <a href="https://github.com/rubygems/">GitHub org</a>, not the website) <a href="https://joel.drapper.me/p/ruby-central-security-measures/">suffered</a> a <a href="https://pup-e.com/blog/goodbye-rubygems/">hostile takeover</a> in September 2025.</td>
    </tr>
    <tr>
      <td>Ultimately <a href="https://www.reddit.com/r/ruby/s/gOk42POCaV">4 maintainers</a> were <a href="https://bsky.app/profile/martinemde.com/post/3m3occezxxs2q">hard removed</a> and a reason has been given for only 1 of those, while 2 others resigned in protest.</td>
    </tr>
    <tr>
      <td>It is a <a href="https://joel.drapper.me/p/ruby-central-takeover/">complicated story</a> which is difficult to <a href="https://joel.drapper.me/p/ruby-central-fact-check/">parse quickly</a>.</td>
    </tr>
    <tr>
      <td>Simply put - there was active policy for adding or removing maintainers/owners of <a href="https://github.com/ruby/rubygems/blob/b1ab33a3d52310a84d16b193991af07f5a6a07c0/doc/rubygems/POLICIES.md?plain=1#L187-L196">rubygems</a> and <a href="https://github.com/ruby/rubygems/blob/b1ab33a3d52310a84d16b193991af07f5a6a07c0/doc/bundler/playbooks/TEAM_CHANGES.md">bundler</a>, and those <a href="https://www.reddit.com/r/ruby/comments/1ove9vp/rubycentral_hates_this_one_fact/">policies were not followed</a>.</td>
    </tr>
    <tr>
      <td>I‚Äôm adding notes like this to gems because I <a href="https://joel.drapper.me/p/ruby-central/">don‚Äôt condone theft</a> of repositories or gems from their rightful owners.</td>
    </tr>
    <tr>
      <td>If a similar theft happened with my repos/gems, I‚Äôd hope some would stand up for me.</td>
    </tr>
    <tr>
      <td>Disenfranchised former-maintainers have started <a href="https://gem.coop">gem.coop</a>.</td>
    </tr>
    <tr>
      <td>Once available I will publish there exclusively; unless RubyCentral makes amends with the community.</td>
    </tr>
    <tr>
      <td>The <a href="https://youtu.be/_H4qbtC5qzU?si=BvuBU90R2wAqD2E6">‚ÄúTechnology for Humans: Joel Draper‚Äù</a> podcast episode by <a href="https://reinteractive.com/ruby-on-rails">reinteractive</a> is the most cogent summary I‚Äôm aware of.</td>
    </tr>
    <tr>
      <td>See <a href="https://github.com/gem-coop/gem.coop/issues/12">here</a>, <a href="https://gem.coop">here</a> and <a href="https://martinemde.com/2025/10/05/announcing-gem-coop.html">here</a> for more info on what comes next.</td>
    </tr>
    <tr>
      <td>What I‚Äôm doing: A (WIP) proposal for <a href="https://github.com/galtzo-floss/bundle-namespace">bundler/gem scopes</a>, and a (WIP) proposal for a federated <a href="https://github.com/galtzo-floss/gem-server">gem server</a>.</td>
    </tr>
  </tbody>
</table>

<p><a href="https://discord.gg/3qme4XHNKN"><img src="https://logos.galtzo.com/assets/images/galtzo-floss/avatar-192px.svg" alt="Galtzo FLOSS Logo by Aboling0, CC BY-SA 4.0"></a> <a href="https://www.ruby-lang.org/"><img src="https://logos.galtzo.com/assets/images/ruby-lang/avatar-192px.svg" alt="ruby-lang Logo, Yukihiro Matsumoto, Ruby Visual Identity Team, CC BY-SA 2.5"></a> <a href="https://github.com/kettle-rb"><img src="https://logos.galtzo.com/assets/images/kettle-rb/avatar-192px.svg" alt="kettle-rb Logo by Aboling0, CC BY-SA 4.0"></a></p>

<h1 id="-treehaver">üå¥ TreeHaver</h1>

<p><a href="https://bestgems.org/gems/tree_haver"><img src="https://img.shields.io/gem/v/tree_haver.svg" alt="Version"></a> <a href="http://github.com/kettle-rb/tree_haver/releases"><img src="https://img.shields.io/github/tag/kettle-rb/tree_haver.svg" alt="GitHub tag (latest SemVer)"></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-259D6C.svg" alt="License: MIT"></a> <a href="https://bestgems.org/gems/tree_haver"><img src="https://img.shields.io/gem/rd/tree_haver.svg" alt="Downloads Rank"></a> <a href="https://www.codetriage.com/kettle-rb/tree_haver"><img src="https://www.codetriage.com/kettle-rb/tree_haver/badges/users.svg" alt="Open Source Helpers"></a> <a href="https://codecov.io/gh/kettle-rb/tree_haver"><img src="https://codecov.io/gh/kettle-rb/tree_haver/graph/badge.svg" alt="CodeCov Test Coverage"></a> <a href="https://coveralls.io/github/kettle-rb/tree_haver?branch=main"><img src="https://coveralls.io/repos/github/kettle-rb/tree_haver/badge.svg?branch=main" alt="Coveralls Test Coverage"></a> <a href="https://qlty.sh/gh/kettle-rb/projects/tree_haver/metrics/code?sort=coverageRating"><img src="https://qlty.sh/gh/kettle-rb/projects/tree_haver/coverage.svg" alt="QLTY Test Coverage"></a> <a href="https://qlty.sh/gh/kettle-rb/projects/tree_haver"><img src="https://qlty.sh/gh/kettle-rb/projects/tree_haver/maintainability.svg" alt="QLTY Maintainability"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/heads.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/heads.yml/badge.svg" alt="CI Heads"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/dep-heads.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/dep-heads.yml/badge.svg" alt="CI Runtime Dependencies @ HEAD"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/current.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/current.yml/badge.svg" alt="CI Current"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/truffle.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/truffle.yml/badge.svg" alt="CI Truffle Ruby"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/locked_deps.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/locked_deps.yml/badge.svg" alt="Deps Locked"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/unlocked_deps.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/unlocked_deps.yml/badge.svg" alt="Deps Unlocked"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/supported.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/supported.yml/badge.svg" alt="CI Supported"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/coverage.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/coverage.yml/badge.svg" alt="CI Test Coverage"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/style.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/style.yml/badge.svg" alt="CI Style"></a> <a href="https://github.com/kettle-rb/tree_haver/security/code-scanning"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/codeql-analysis.yml/badge.svg" alt="CodeQL"></a> <a href="https://github.com/kettle-rb/tree_haver/actions/workflows/license-eye.yml"><img src="https://github.com/kettle-rb/tree_haver/actions/workflows/license-eye.yml/badge.svg" alt="Apache SkyWalking Eyes License Compatibility Check"></a></p>

<p><code>if ci_badges.map(&amp;:color).detect { it != "green"}</code> ‚òùÔ∏è <a href="https://discord.gg/3qme4XHNKN">let me know</a>, as I may have missed the <a href="https://discord.gg/3qme4XHNKN">discord notification</a>.</p>

<hr>

<p><code>if ci_badges.map(&amp;:color).all? { it == "green"}</code> üëáÔ∏è send money so I can do more of this. FLOSS maintenance is now my full-time job.</p>

<p><a href="https://opencollective.com/kettle-rb#backer"><img src="https://opencollective.com/kettle-rb/backers/badge.svg?style=flat" alt="OpenCollective Backers"></a> <a href="https://opencollective.com/kettle-rb#sponsor"><img src="https://opencollective.com/kettle-rb/sponsors/badge.svg?style=flat" alt="OpenCollective Sponsors"></a> <a href="https://github.com/sponsors/pboling"><img src="https://img.shields.io/badge/Sponsor_Me!-pboling.svg?style=social&amp;logo=github" alt="Sponsor Me on Github"></a> <a href="https://liberapay.com/pboling/donate"><img src="https://img.shields.io/liberapay/goal/pboling.svg?logo=liberapay&amp;color=a51611&amp;style=flat" alt="Liberapay Goal Progress"></a> <a href="https://www.paypal.com/paypalme/peterboling"><img src="https://img.shields.io/badge/donate-paypal-a51611.svg?style=flat&amp;logo=paypal" alt="Donate on PayPal"></a> <a href="https://www.buymeacoffee.com/pboling"><img src="https://img.shields.io/badge/buy_me_a_coffee-%E2%9C%93-a51611.svg?style=flat" alt="Buy me a coffee"></a> <a href="https://polar.sh/pboling"><img src="https://img.shields.io/badge/polar-donate-a51611.svg?style=flat" alt="Donate on Polar"></a> <a href="https://ko-fi.com/O5O86SNP4"><img src="https://img.shields.io/badge/ko--fi-%E2%9C%93-a51611.svg?style=flat" alt="Donate at ko-fi.com"></a></p>

<h2 id="-synopsis">üåª Synopsis</h2>

<p>TreeHaver is a cross-Ruby adapter for the <a href="https://tree-sitter.github.io/tree-sitter/">tree-sitter</a> and <a href="https://github.com/mjackson/citrus">Citrus</a> parsing libraries and other dedicated parsing tools that works seamlessly across MRI Ruby, JRuby, and TruffleRuby. It provides a unified API for parsing source code using grammars, regardless of your Ruby implementation.</p>

<h3 id="the-adapter-pattern-like-faraday-but-for-parsing">The Adapter Pattern: Like Faraday, but for Parsing</h3>

<p>If you‚Äôve used <a href="https://github.com/lostisland/faraday">Faraday</a>, <a href="https://github.com/intridea/multi_json">multi_json</a>, or <a href="https://github.com/sferik/multi_xml">multi_xml</a>, you‚Äôll feel right at home with TreeHaver. These gems share a common philosophy:</p>

<table>
  <thead>
    <tr>
      <th>Gem</th>
      <th>Unified API for</th>
      <th>Backend Examples</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Faraday</strong></td>
      <td>HTTP requests</td>
      <td>Net::HTTP, Typhoeus, Patron, Excon</td>
    </tr>
    <tr>
      <td><strong>multi_json</strong></td>
      <td>JSON parsing</td>
      <td>Oj, Yajl, JSON gem</td>
    </tr>
    <tr>
      <td><strong>multi_xml</strong></td>
      <td>XML parsing</td>
      <td>Nokogiri, LibXML, Ox</td>
    </tr>
    <tr>
      <td><strong>TreeHaver</strong></td>
      <td>Code parsing</td>
      <td>MRI, Rust, FFI, Java, Prism, Psych, Commonmarker, Markly, Citrus (&amp; Co.)</td>
    </tr>
  </tbody>
</table>

<p><strong>Write once, run anywhere.</strong></p>

<p><strong>Learn once, write anywhere.</strong></p>

<p>Just as Faraday lets you swap HTTP adapters without changing your code, TreeHaver lets you swap tree-sitter backends. Your parsing code remains the same whether you‚Äôre running on MRI with native C extensions, JRuby with FFI, or TruffleRuby.</p>

<pre class="code language-ruby"><code class="language-ruby"># Your code stays the same regardless of backend
parser = TreeHaver::Parser.new
parser.language = TreeHaver::Language.from_library(&quot;/path/to/grammar.so&quot;)
tree = parser.parse(source_code)

# TreeHaver automatically picks the best backend:
# - MRI ‚Üí ruby_tree_sitter (C extensions)
# - JRuby ‚Üí FFI (system&#39;s libtree-sitter)
# - TruffleRuby ‚Üí FFI or MRI backend
</code></pre>

<h3 id="key-features">Key Features</h3>

<ul>
  <li>
<strong>Universal Ruby Support</strong>: Works on MRI Ruby, JRuby, and TruffleRuby</li>
  <li>
<strong>10 Parsing Backends</strong> - Choose the right backend for your needs:
    <ul>
      <li>
<strong>Tree-sitter Backends</strong> (high-performance, incremental parsing):
        <ul>
          <li>
<strong>MRI Backend</strong>: Leverages <a href="https://github.com/Faveod/ruby-tree-sitter"><code>ruby_tree_sitter</code></a> gem (C extension, fastest on MRI)</li>
          <li>
<strong>Rust Backend</strong>: Uses <a href="https://github.com/anthropics/tree_stump"><code>tree_stump</code></a> gem (Rust with precompiled binaries)
            <ul>
              <li>
<strong>Note</strong>: Currently requires <a href="https://github.com/pboling/tree_stump/tree/tree_haver">pboling‚Äôs fork</a> until PRs <a href="https://github.com/joker1007/tree_stump/pull/5">#5</a>, <a href="https://github.com/joker1007/tree_stump/pull/7">#7</a>, <a href="https://github.com/joker1007/tree_stump/pull/11">#11</a>, and <a href="https://github.com/joker1007/tree_stump/pull/13">#13</a> are merged</li>
            </ul>
          </li>
          <li>
<strong>FFI Backend</strong>: Pure Ruby FFI bindings to <code>libtree-sitter</code> (ideal for JRuby, TruffleRuby)</li>
          <li>
<strong>Java Backend</strong>: Native Java integration for JRuby with java-tree-sitter grammar JARs</li>
        </ul>
      </li>
      <li>
<strong>Language-Specific Backends</strong> (native parser integration):
        <ul>
          <li>
<strong>Prism Backend</strong>: Ruby‚Äôs official parser (<a href="https://github.com/ruby/prism">Prism</a>, stdlib in Ruby 3.4+)</li>
          <li>
<strong>Psych Backend</strong>: Ruby‚Äôs YAML parser (<a href="https://github.com/ruby/psych">Psych</a>, stdlib)</li>
          <li>
<strong>Commonmarker Backend</strong>: Fast Markdown parser (<a href="https://github.com/gjtorikian/commonmarker">Commonmarker</a>, comrak Rust)</li>
          <li>
<strong>Markly Backend</strong>: GitHub Flavored Markdown (<a href="https://github.com/ioquatix/markly">Markly</a>, cmark-gfm C)</li>
        </ul>
      </li>
      <li>
<strong>Pure Ruby Fallback</strong>:
        <ul>
          <li>
<strong>Citrus Backend</strong>: Pure Ruby parsing via <a href="https://github.com/mjackson/citrus"><code>citrus</code></a> (no native dependencies)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<strong>Automatic Backend Selection</strong>: Intelligently selects the best backend for your Ruby implementation</li>
  <li>
<strong>Language Agnostic</strong>: Parse any language - Ruby, Markdown, YAML, JSON, Bash, TOML, JavaScript, etc.</li>
  <li>
<strong>Grammar Discovery</strong>: Built-in <code>GrammarFinder</code> utility for platform-aware grammar library discovery</li>
  <li>
<strong>Unified Position API</strong>: Consistent <code>start_line</code>, <code>end_line</code>, <code>source_position</code> across all backends</li>
  <li>
<strong>Thread-Safe</strong>: Built-in language registry with thread-safe caching</li>
  <li>
<strong>Minimal API Surface</strong>: Simple, focused API that covers the most common use cases</li>
</ul>

<h3 id="backend-requirements">Backend Requirements</h3>

<p>TreeHaver has minimal dependencies and automatically selects the best backend for your Ruby implementation. Each backend has specific version requirements:</p>

<h4 id="mri-backend-ruby_tree_sitter-c-extensions">MRI Backend (ruby_tree_sitter, C extensions)</h4>

<p><strong>Requires <code>ruby_tree_sitter</code> v2.0+</strong></p>

<p>In ruby_tree_sitter v2.0, all TreeSitter exceptions were changed to inherit from <code>Exception</code> (not <code>StandardError</code>). This was an intentional breaking change made for thread-safety and signal handling reasons.</p>

<p><strong>Exception Mapping</strong>: TreeHaver catches <code>TreeSitter::TreeSitterError</code> and its subclasses, converting them to <code>TreeHaver::NotAvailable</code> while preserving the original error message. This provides a consistent exception API across all backends:</p>

<table>
  <thead>
    <tr>
      <th>ruby_tree_sitter Exception</th>
      <th>TreeHaver Exception</th>
      <th>When It Occurs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>TreeSitter::ParserNotFoundError</code></td>
      <td><code>TreeHaver::NotAvailable</code></td>
      <td>Parser library file cannot be loaded</td>
    </tr>
    <tr>
      <td><code>TreeSitter::LanguageLoadError</code></td>
      <td><code>TreeHaver::NotAvailable</code></td>
      <td>Language symbol loads but returns nothing</td>
    </tr>
    <tr>
      <td><code>TreeSitter::SymbolNotFoundError</code></td>
      <td><code>TreeHaver::NotAvailable</code></td>
      <td>Symbol not found in library</td>
    </tr>
    <tr>
      <td><code>TreeSitter::ParserVersionError</code></td>
      <td><code>TreeHaver::NotAvailable</code></td>
      <td>Parser version incompatible with tree-sitter</td>
    </tr>
    <tr>
      <td><code>TreeSitter::QueryCreationError</code></td>
      <td><code>TreeHaver::NotAvailable</code></td>
      <td>Query creation fails</td>
    </tr>
  </tbody>
</table>

<pre class="code language-ruby"><code class="language-ruby"># Add to your Gemfile for MRI backend
gem &quot;ruby_tree_sitter&quot;, &quot;~&gt; 2.0&quot;
</code></pre>

<h4 id="rust-backend-tree_stump">Rust Backend (tree_stump)</h4>

<p>Currently requires <a href="https://github.com/pboling/tree_stump/tree/tree_haver">pboling‚Äôs fork</a> until upstream PRs are merged.</p>

<pre class="code language-ruby"><code class="language-ruby"># Add to your Gemfile for Rust backend
gem &quot;tree_stump&quot;, github: &quot;pboling/tree_stump&quot;, branch: &quot;tree_haver&quot;
</code></pre>

<h4 id="ffi-backend">FFI Backend</h4>

<p>Requires the <code>ffi</code> gem and a system installation of <code>libtree-sitter</code>:</p>

<pre class="code language-ruby"><code class="language-ruby"># Add to your Gemfile for FFI backend
gem &quot;ffi&quot;, &quot;&gt;= 1.15&quot;, &quot;&lt; 2.0&quot;
</code></pre>

<pre class="code language-bash"><code class="language-bash"># Install libtree-sitter on your system:
# macOS
brew install tree-sitter

# Ubuntu/Debian
apt-get install libtree-sitter0 libtree-sitter-dev

# Fedora
dnf install tree-sitter tree-sitter-devel
</code></pre>

<h4 id="citrus-backend">Citrus Backend</h4>

<p>Pure Ruby parser with no native dependencies:</p>

<pre class="code language-ruby"><code class="language-ruby"># Add to your Gemfile for Citrus backend
gem &quot;citrus&quot;, &quot;~&gt; 3.0&quot;
</code></pre>

<h4 id="java-backend-jruby-only">Java Backend (JRuby only)</h4>

<p>No additional dependencies required beyond grammar JARs built for java-tree-sitter.</p>

<h3 id="why-treehaver">Why TreeHaver?</h3>

<p>tree-sitter is a powerful parser generator that creates incremental parsers for many programming languages. However, integrating it into Ruby applications can be challenging:</p>

<ul>
  <li>MRI-based C extensions don‚Äôt work on JRuby</li>
  <li>FFI-based solutions may not be optimal for MRI</li>
  <li>Managing different backends for different Ruby implementations is cumbersome</li>
</ul>

<p>TreeHaver solves these problems by providing a unified API that automatically selects the appropriate backend for your Ruby implementation, allowing you to write code once and run it anywhere.</p>

<h3 id="comparison-with-other-ruby-ast--parser-bindings">Comparison with Other Ruby AST / Parser Bindings</h3>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>
<a href="https://github.com/kettle-rb/tree_haver">tree_haver</a> (this gem)</th>
      <th><a href="https://github.com/Faveod/ruby-tree-sitter">ruby_tree_sitter</a></th>
      <th><a href="https://github.com/anthropics/tree_stump">tree_stump</a></th>
      <th><a href="https://github.com/mjackson/citrus">citrus</a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>MRI Ruby</strong></td>
      <td>‚úÖ Yes</td>
      <td>‚úÖ Yes</td>
      <td>‚úÖ Yes</td>
      <td>‚úÖ Yes</td>
    </tr>
    <tr>
      <td><strong>JRuby</strong></td>
      <td>‚úÖ Yes (FFI, Java, or Citrus backend)</td>
      <td>‚ùå No</td>
      <td>‚ùå No</td>
      <td>‚úÖ Yes</td>
    </tr>
    <tr>
      <td><strong>TruffleRuby</strong></td>
      <td>‚úÖ Yes (FFI or Citrus)</td>
      <td>‚ùå No</td>
      <td>‚ùì Unknown</td>
      <td>‚úÖ Yes</td>
    </tr>
    <tr>
      <td><strong>Backend</strong></td>
      <td>Multi (MRI C, Rust, FFI, Java, Citrus)</td>
      <td>C extension only</td>
      <td>Rust extension</td>
      <td>Pure Ruby</td>
    </tr>
    <tr>
      <td><strong>Incremental Parsing</strong></td>
      <td>‚úÖ Via MRI C/Rust/Java backend</td>
      <td>‚úÖ Yes</td>
      <td>‚úÖ Yes</td>
      <td>‚ùå No</td>
    </tr>
    <tr>
      <td><strong>Query API</strong></td>
      <td>‚ö° Via MRI/Rust/Java backend</td>
      <td>‚úÖ Yes</td>
      <td>‚úÖ Yes</td>
      <td>‚ùå No</td>
    </tr>
    <tr>
      <td><strong>Grammar Discovery</strong></td>
      <td>‚úÖ Built-in <code>GrammarFinder</code>
</td>
      <td>‚ùå Manual</td>
      <td>‚ùå Manual</td>
      <td>‚ùå Manual</td>
    </tr>
    <tr>
      <td><strong>Security Validations</strong></td>
      <td>‚úÖ <code>PathValidator</code>
</td>
      <td>‚ùå No</td>
      <td>‚ùå No</td>
      <td>‚ùå No</td>
    </tr>
    <tr>
      <td><strong>Language Registration</strong></td>
      <td>‚úÖ Thread-safe registry</td>
      <td>‚ùå No</td>
      <td>‚ùå No</td>
      <td>‚ùå No</td>
    </tr>
    <tr>
      <td><strong>Native Performance</strong></td>
      <td>‚ö° Backend-dependent</td>
      <td>‚úÖ Native C</td>
      <td>‚úÖ Native Rust</td>
      <td>‚ùå Pure Ruby</td>
    </tr>
    <tr>
      <td><strong>Precompiled Binaries</strong></td>
      <td>‚ö° Via Rust backend</td>
      <td>‚úÖ Yes</td>
      <td>‚úÖ Yes</td>
      <td>‚úÖ Pure Ruby</td>
    </tr>
    <tr>
      <td><strong>Zero Native Deps</strong></td>
      <td>‚ö° Via Citrus backend</td>
      <td>‚ùå No</td>
      <td>‚ùå No</td>
      <td>‚úÖ Yes</td>
    </tr>
    <tr>
      <td><strong>Minimum Ruby</strong></td>
      <td>3.2+</td>
      <td>3.0+</td>
      <td>3.1+</td>
      <td>0+</td>
    </tr>
  </tbody>
</table>

<p><strong>Note:</strong> Java backend works with grammar JARs built specifically for java-tree-sitter, or grammar .so files that statically link tree-sitter. This is why FFI is recommended for JRuby &amp; TruffleRuby.</p>

<p><strong>Note:</strong> TreeHaver can use <code>ruby_tree_sitter</code> (MRI) or <code>tree_stump</code> (MRI, JRuby?) as backends, or <code>jruby-tree-sitter</code> (JRuby), giving you TreeHaver‚Äôs unified API, grammar discovery, and security features, plus full access to incremental parsing when using those backends.</p>

<p><strong>Note:</strong> <code>tree_stump</code> currently requires <a href="https://github.com/pboling/tree_stump/tree/tree_haver">pboling‚Äôs fork (tree_haver branch)</a> until upstream PRs <a href="https://github.com/joker1007/tree_stump/pull/5">#5</a>, <a href="https://github.com/joker1007/tree_stump/pull/7">#7</a>, <a href="https://github.com/joker1007/tree_stump/pull/11">#11</a>, and <a href="https://github.com/joker1007/tree_stump/pull/13">#13</a> are merged.</p>

<h4 id="when-to-use-each">When to Use Each</h4>

<p><strong>Choose TreeHaver when:</strong></p>

<ul>
  <li>You need JRuby or TruffleRuby support</li>
  <li>You‚Äôre building a library that should work across Ruby implementations</li>
  <li>You want automatic grammar discovery and security validations</li>
  <li>You want flexibility to switch backends without code changes</li>
  <li>You need incremental parsing with a unified API</li>
</ul>

<p><strong>Choose ruby_tree_sitter directly when:</strong></p>

<ul>
  <li>You only target MRI Ruby</li>
  <li>You need the full Query API without abstraction</li>
  <li>You want t