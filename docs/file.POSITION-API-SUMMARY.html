<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: POSITION-API-SUMMARY
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "POSITION-API-SUMMARY";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: POSITION-API-SUMMARY</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="position-api">Position API</h1>

<p>TreeHaver provides a unified Position API across all backends, enabling consistent access to node position information regardless of the underlying parser.</p>

<h2 id="methods">Methods</h2>

<p>All Node classes implement the following position methods:</p>

<h3 id="start_line"><code>start_line</code></h3>

<p>Returns the 1-based line number where the node starts.</p>

<ul>
  <li>For backends with 0-based rows: <code>start_point.row + 1</code>
</li>
  <li>For backends with native 1-based lines: uses the backend’s value directly</li>
</ul>

<h3 id="end_line"><code>end_line</code></h3>

<p>Returns the 1-based line number where the node ends.</p>

<ul>
  <li>For backends with 0-based rows: <code>end_point.row + 1</code>
</li>
  <li>For backends with native 1-based lines: uses the backend’s value directly</li>
</ul>

<h3 id="source_position"><code>source_position</code></h3>

<p>Returns a position hash with 1-based lines and 0-based columns:</p>

<pre class="code language-ruby"><code class="language-ruby">{start_line:, end_line:, start_column:, end_column:}
</code></pre>

<ul>
  <li>Lines are 1-based (human-readable)</li>
  <li>Columns are 0-based (matches tree-sitter convention)</li>
  <li>Compatible with <code>*-merge</code> gems’ <code>FileAnalysisBase</code> expectations</li>
</ul>

<h3 id="first_child"><code>first_child</code></h3>

<p>Returns <code>children.first</code> (or <code>child(0)</code> for some backends).</p>

<p>Convenience method for node iteration.</p>

<hr>

<h2 id="backend-support">Backend Support</h2>

<h3 id="treehaverbasenode">TreeHaver::Base::Node</h3>

<p>The base class defines the Position API contract. All position methods (<code>start_line</code>, <code>end_line</code>, <code>source_position</code>, <code>first_child</code>) are implemented here with sensible defaults that handle both Hash and Object-style point representations.</p>

<p>All backend Node classes inherit from <code>Base::Node</code>.</p>

<h3 id="treehavernode-tree-sitter-backends">TreeHaver::Node (Tree-sitter Backends)</h3>

<p>Inherits from <code>Base::Node</code>. Wraps raw <code>::TreeSitter::Node</code> objects from:</p>

<ul>
  <li>Tree-sitter MRI backend</li>
  <li>Tree-sitter FFI backend</li>
  <li>Tree-sitter Java backend</li>
  <li>Tree-sitter Rust backend</li>
</ul>

<h3 id="commonmarker-backend">Commonmarker Backend</h3>

<p><code>TreeHaver::Backends::Commonmarker::Node</code> inherits from <code>Base::Node</code>.</p>

<p>Overrides position methods to use Commonmarker’s <code>sourcepos</code> array, which provides 1-based line numbers directly.</p>

<h3 id="markly-backend">Markly Backend</h3>

<p><code>TreeHaver::Backends::Markly::Node</code> inherits from <code>Base::Node</code>.</p>

<p>Overrides position methods to use Markly’s <code>source_position</code> hash, which provides 1-based line numbers directly.</p>

<h3 id="prism-backend">Prism Backend</h3>

<p><code>TreeHaver::Backends::Prism::Node</code> inherits from <code>Base::Node</code>.</p>

<p>Overrides position methods to use Prism’s <code>Location</code> object, which provides 1-based line numbers directly.</p>

<h3 id="psych-backend">Psych Backend</h3>

<p><code>TreeHaver::Backends::Psych::Node</code> inherits from <code>Base::Node</code>.</p>

<p>Uses the inherited implementation, which calculates from <code>start_point.row + 1</code> and <code>end_point.row + 1</code>.</p>

<h3 id="citrus-backend">Citrus Backend</h3>

<p><code>TreeHaver::Backends::Citrus::Node</code> inherits from <code>Base::Node</code>.</p>

<p>Uses the inherited implementation, which handles both Hash (<code>start_point[:row]</code>) and Object (<code>start_point.row</code>) point representations.</p>

<hr>

<h2 id="usage-example">Usage Example</h2>

<pre class="code language-ruby"><code class="language-ruby">require &quot;tree_haver/backends/psych&quot;

parser = TreeHaver::Backends::Psych::Parser.new
parser.language = TreeHaver::Backends::Psych::Language.yaml
tree = parser.parse(&quot;foo: bar&quot;)
node = tree.root_node

node.start_line      # =&gt; 1
node.end_line        # =&gt; 2
node.source_position # =&gt; {start_line: 1, end_line: 2, start_column: 0, end_column: 0}
node.first_child     # =&gt; &lt;first child node&gt;
</code></pre>

<hr>

<h2 id="implementation-notes">Implementation Notes</h2>

<h3 id="base-class-with-overrides">Base Class with Overrides</h3>

<p>The Position API uses inheritance from <code>TreeHaver::Base::Node</code>:</p>

<ol>
  <li>
<strong>Shared Implementation</strong> - <code>Base::Node</code> provides default implementations that handle both Hash and Object point representations</li>
  <li>
<strong>Backend Overrides</strong> - Backends with native 1-based line numbers (Commonmarker, Markly, Prism) override the methods to use their optimized representations</li>
  <li>
<strong>Automatic Inheritance</strong> - Backends without overrides (Psych, Citrus, tree-sitter) inherit the working defaults</li>
</ol>

<h3 id="conversion-formulas">Conversion Formulas</h3>

<table>
  <thead>
    <tr>
      <th>Backend Type</th>
      <th>Line Calculation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>tree-sitter, Psych, Citrus</td>
      <td>
<code>start_point.row + 1</code> (inherited from Base::Node)</td>
    </tr>
    <tr>
      <td>Commonmarker, Markly, Prism</td>
      <td>Native 1-based value (overridden methods)</td>
    </tr>
  </tbody>
</table>

<h3 id="language-agnostic">Language-Agnostic</h3>

<p>Position information is a property of the source text, not the language. These methods work identically for:</p>

<ul>
  <li>Ruby (Prism backend)</li>
  <li>Markdown (Commonmarker, Markly backends)</li>
  <li>YAML (Psych backend)</li>
  <li>TOML (Citrus backend via toml-rb)</li>
  <li>JSON (tree-sitter backends)</li>
</ul>
</div></div>

      <div id="footer">
  Generated on Mon Jan 12 14:55:51 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.0).
</div>

    </div>
  </body>
</html>