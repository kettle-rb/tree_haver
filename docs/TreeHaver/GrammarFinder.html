<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: TreeHaver::GrammarFinder
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "TreeHaver::GrammarFinder";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (G)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span>
     &raquo; 
    <span class="title">GrammarFinder</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: TreeHaver::GrammarFinder
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">TreeHaver::GrammarFinder</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/tree_haver/grammar_finder.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Generic utility for finding tree-sitter grammar shared libraries.</p>

<p>GrammarFinder provides platform-aware discovery of tree-sitter grammar<br />
libraries. Given a language name, it searches common installation paths<br />
and supports environment variable overrides.</p>

<p>This class is designed to be used by language-specific merge gems<br />
(toml-merge, json-merge, bash-merge, etc.) without requiring TreeHaver<br />
to have knowledge of each specific language.</p>

<p>== Security Considerations</p>

<p>Loading shared libraries is inherently dangerous as it executes arbitrary<br />
native code. GrammarFinder performs the following security validations:</p>

<ul>
  <li>Language names are validated to contain only safe characters</li>
  <li>Paths from environment variables are validated before use</li>
  <li>Path traversal attempts (../) are rejected</li>
  <li>Only files with expected extensions (.so, .dylib, .dll) are accepted</li>
</ul>

<p>For additional security, use <span class='object_link'><a href="#find_library_path_safe-instance_method" title="TreeHaver::GrammarFinder#find_library_path_safe (method)">#find_library_path_safe</a></span> which only returns<br />
paths from trusted system directories.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'><p>Basic usage</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_finder'>finder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'>GrammarFinder</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="TreeHaver::GrammarFinder#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='symbol'>:toml</span><span class='rparen'>)</span>
<span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_finder'>finder</span><span class='period'>.</span><span class='id identifier rubyid_find_library_path'>find_library_path</span>
<span class='comment'># =&gt; &quot;/usr/lib/libtree-sitter-toml.so&quot;</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Check availability</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_finder'>finder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'>GrammarFinder</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="TreeHaver::GrammarFinder#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='symbol'>:json</span><span class='rparen'>)</span>
<span class='kw'>if</span> <span class='id identifier rubyid_finder'>finder</span><span class='period'>.</span><span class='id identifier rubyid_available?'>available?</span>
  <span class='id identifier rubyid_language'>language</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Language.html" title="TreeHaver::Language (class)">Language</a></span></span><span class='period'>.</span><span class='id identifier rubyid_load'><span class='object_link'><a href="Language.html#load-class_method" title="TreeHaver::Language.load (method)">load</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_finder'>finder</span><span class='period'>.</span><span class='id identifier rubyid_language_name'>language_name</span><span class='comma'>,</span> <span class='id identifier rubyid_finder'>finder</span><span class='period'>.</span><span class='id identifier rubyid_find_library_path'>find_library_path</span><span class='rparen'>)</span>
<span class='kw'>end</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Register with TreeHaver</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_finder'>finder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'>GrammarFinder</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="TreeHaver::GrammarFinder#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='symbol'>:bash</span><span class='rparen'>)</span>
<span class='id identifier rubyid_finder'>finder</span><span class='period'>.</span><span class='id identifier rubyid_register!'>register!</span> <span class='kw'>if</span> <span class='id identifier rubyid_finder'>finder</span><span class='period'>.</span><span class='id identifier rubyid_available?'>available?</span>
<span class='comment'># Now you can use: TreeHaver::Language.bash</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>With custom search paths</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_finder'>finder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'>GrammarFinder</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="TreeHaver::GrammarFinder#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='symbol'>:toml</span><span class='comma'>,</span> <span class='label'>extra_paths:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/opt/custom/lib</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Secure mode (trusted directories only)</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_finder'>finder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'>GrammarFinder</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="TreeHaver::GrammarFinder#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='symbol'>:toml</span><span class='rparen'>)</span>
<span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_finder'>finder</span><span class='period'>.</span><span class='id identifier rubyid_find_library_path_safe'>find_library_path_safe</span>  <span class='comment'># Only returns paths in trusted dirs</span></code></pre>
    
  </div>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="PathValidator.html" title="TreeHaver::PathValidator (module)">For details on security validations</a></span></li>
    
  </ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="BASE_SEARCH_DIRS-constant" class="">BASE_SEARCH_DIRS =
          <div class="docstring">
  <div class="discussion">
    <p>Common base directories where tree-sitter libraries are installed<br />
Platform-specific extensions are appended automatically</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/lib</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/lib64</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/local/lib</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/opt/homebrew/lib</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="TREE_SITTER_BACKENDS-constant" class="">TREE_SITTER_BACKENDS =
          <div class="docstring">
  <div class="discussion">
    <p>Backends that use tree-sitter (require native runtime libraries)<br />
Other backends (Citrus, Prism, Psych, etc.) don’t use tree-sitter</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends.html" title="TreeHaver::Backends (module)">Backends</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends/MRI.html" title="TreeHaver::Backends::MRI (module)">MRI</a></span></span><span class='comma'>,</span>
  <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends.html" title="TreeHaver::Backends (module)">Backends</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends/FFI.html" title="TreeHaver::Backends::FFI (module)">FFI</a></span></span><span class='comma'>,</span>
  <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends.html" title="TreeHaver::Backends (module)">Backends</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends/Rust.html" title="TreeHaver::Backends::Rust (module)">Rust</a></span></span><span class='comma'>,</span>
  <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends.html" title="TreeHaver::Backends (module)">Backends</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Backends/Java.html" title="TreeHaver::Backends::Java (module)">Java</a></span></span><span class='comma'>,</span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#extra_paths-instance_method" title="#extra_paths (instance method)">#<strong>extra_paths</strong>  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Additional search paths provided at initialization.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#language_name-instance_method" title="#language_name (instance method)">#<strong>language_name</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The language identifier.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_runtime_check!-class_method" title="reset_runtime_check! (class method)">.<strong>reset_runtime_check!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'><p>Reset the cached tree-sitter runtime check (for testing).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tree_sitter_runtime_usable%3F-class_method" title="tree_sitter_runtime_usable? (class method)">.<strong>tree_sitter_runtime_usable?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Check if the tree-sitter runtime is usable.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#available%3F-instance_method" title="#available? (instance method)">#<strong>available?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Check if the grammar library is available AND usable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#available_safe%3F-instance_method" title="#available_safe? (instance method)">#<strong>available_safe?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Check if the grammar library is available in a trusted directory.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#env_var_name-instance_method" title="#env_var_name (instance method)">#<strong>env_var_name</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get the environment variable name for this language.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_library_path-instance_method" title="#find_library_path (instance method)">#<strong>find_library_path</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Find the grammar library path.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_library_path_safe-instance_method" title="#find_library_path_safe (instance method)">#<strong>find_library_path_safe</strong>  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Find the grammar library path with strict security validation.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(language_name, extra_paths: [], validate: true)  &#x21d2; GrammarFinder </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Initialize a grammar finder for a specific language.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#library_filename-instance_method" title="#library_filename (instance method)">#<strong>library_filename</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get the library filename for the current platform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#not_found_message-instance_method" title="#not_found_message (instance method)">#<strong>not_found_message</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get a human-readable error message when library is not found.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register!-instance_method" title="#register! (instance method)">#<strong>register!</strong>(raise_on_missing: false)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Register this language with TreeHaver.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#search_info-instance_method" title="#search_info (instance method)">#<strong>search_info</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get debug information about the search.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#search_paths-instance_method" title="#search_paths (instance method)">#<strong>search_paths</strong>  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Generate the full list of search paths for this language.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#symbol_name-instance_method" title="#symbol_name (instance method)">#<strong>symbol_name</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get the expected symbol name exported by the grammar library.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_env_path-instance_method" title="#validate_env_path (instance method)">#<strong>validate_env_path</strong>(path)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Validate an environment variable path and return reason if invalid.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(language_name, extra_paths: [], validate: true)  &#x21d2; <tt><span class='object_link'><a href="" title="TreeHaver::GrammarFinder (class)">GrammarFinder</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Initialize a grammar finder for a specific language</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>language_name</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the tree-sitter language name (e.g., :toml, :json, :bash)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>extra_paths</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>additional paths to search (searched first after ENV)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>validate</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>if true, validates the language name (default: true)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if language_name is invalid and validate is true</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


75
76
77
78
79
80
81
82
83
84
85</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 75</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_language_name'>language_name</span><span class='comma'>,</span> <span class='label'>extra_paths:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>validate:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_name_str'>name_str</span> <span class='op'>=</span> <span class='id identifier rubyid_language_name'>language_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_validate'>validate</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'><span class='object_link'><a href="PathValidator.html" title="TreeHaver::PathValidator (module)">PathValidator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_safe_language_name?'><span class='object_link'><a href="PathValidator.html#safe_language_name%3F-class_method" title="TreeHaver::PathValidator.safe_language_name? (method)">safe_language_name?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_name_str'>name_str</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid language name: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_language_name'>language_name</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>. </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Language names must start with a letter and contain only lowercase letters, numbers, and underscores.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@language_name</span> <span class='op'>=</span> <span class='id identifier rubyid_name_str'>name_str</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='ivar'>@extra_paths</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_extra_paths'>extra_paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="extra_paths-instance_method">
  
    #<strong>extra_paths</strong>  &#x21d2; <tt>Array&lt;String&gt;</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns additional search paths provided at initialization.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>additional search paths provided at initialization</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extra_paths'>extra_paths</span>
  <span class='ivar'>@extra_paths</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="language_name-instance_method">
  
    #<strong>language_name</strong>  &#x21d2; <tt>Symbol</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the language identifier.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the language identifier</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_language_name'>language_name</span>
  <span class='ivar'>@language_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="reset_runtime_check!-class_method">
  
    .<strong>reset_runtime_check!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>
<p>Reset the cached tree-sitter runtime check (for testing)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 284</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_runtime_check!'>reset_runtime_check!</span>
  <span class='id identifier rubyid_remove_instance_variable'>remove_instance_variable</span><span class='lparen'>(</span><span class='symbol'>:@tree_sitter_runtime_usable</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@tree_sitter_runtime_usable</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tree_sitter_runtime_usable?-class_method">
  
    .<strong>tree_sitter_runtime_usable?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Check if the tree-sitter runtime is usable</p>

<p>Tests whether we can actually create a tree-sitter parser.<br />
Result is cached since this is expensive and won’t change during runtime.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if tree-sitter runtime is functional</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 258</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tree_sitter_runtime_usable?'>tree_sitter_runtime_usable?</span>
  <span class='kw'>return</span> <span class='ivar'>@tree_sitter_runtime_usable</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@tree_sitter_runtime_usable</span><span class='rparen'>)</span>

  <span class='ivar'>@tree_sitter_runtime_usable</span> <span class='op'>=</span> <span class='kw'>begin</span>
    <span class='comment'># Try to create a parser using the current backend
</span>    <span class='id identifier rubyid_mod'>mod</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='period'>.</span><span class='id identifier rubyid_resolve_backend_module'><span class='object_link'><a href="../TreeHaver.html#resolve_backend_module-class_method" title="TreeHaver.resolve_backend_module (method)">resolve_backend_module</a></span></span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>

    <span class='comment'># Only tree-sitter backends are relevant here
</span>    <span class='comment'># Non-tree-sitter backends (Citrus, Prism, Psych, etc.) don&#39;t use grammar files
</span>    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_mod'>mod</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="#TREE_SITTER_BACKENDS-constant" title="TreeHaver::GrammarFinder::TREE_SITTER_BACKENDS (constant)">TREE_SITTER_BACKENDS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span><span class='rparen'>)</span>

    <span class='comment'># Try to instantiate a parser - this will fail if runtime isn&#39;t available
</span>    <span class='id identifier rubyid_mod'>mod</span><span class='op'>::</span><span class='const'>Parser</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='kw'>true</span>
  <span class='kw'>rescue</span> <span class='const'>NoMethodError</span><span class='comma'>,</span> <span class='const'>LoadError</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="NotAvailable.html" title="TreeHaver::NotAvailable (class)">NotAvailable</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid__e'>_e</span>
    <span class='kw'>false</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid__e'>_e</span>
    <span class='comment'># Catch FFI::NotFoundError and other errors when FFI is loaded
</span>    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="available?-instance_method">
  
    #<strong>available?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Check if the grammar library is available AND usable</p>

<p>This checks:</p>
<ol>
  <li>The grammar library file exists</li>
  <li>The tree-sitter runtime is functional (can create a parser)</li>
</ol>

<p>This prevents registering grammars when tree-sitter isn’t actually usable,<br />
allowing clean fallback to alternative backends like Citrus.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if the library can be found AND tree-sitter runtime works</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 233</span>

<span class='kw'>def</span> <span class='id identifier rubyid_available?'>available?</span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_find_library_path'>find_library_path</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># Check if tree-sitter runtime is actually functional
</span>  <span class='comment'># This is cached at the class level since it&#39;s the same for all grammars
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_tree_sitter_runtime_usable?'>tree_sitter_runtime_usable?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="available_safe?-instance_method">
  
    #<strong>available_safe?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Check if the grammar library is available in a trusted directory</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if the library can be found in a trusted directory</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#find_library_path_safe-instance_method" title="TreeHaver::GrammarFinder#find_library_path_safe (method)">#find_library_path_safe</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


293
294
295</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_available_safe?'>available_safe?</span>
  <span class='op'>!</span><span class='id identifier rubyid_find_library_path_safe'>find_library_path_safe</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="env_var_name-instance_method">
  
    #<strong>env_var_name</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get the environment variable name for this language</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the ENV var name (e.g., “TREE_SITTER_TOML_PATH”)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 90</span>

<span class='kw'>def</span> <span class='id identifier rubyid_env_var_name'>env_var_name</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TREE_SITTER_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@language_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='embexpr_end'>}</span><span class='tstring_content'>_PATH</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_library_path-instance_method">
  
    #<strong>find_library_path</strong>  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Paths from ENV are validated using <span class='object_link'><a href="PathValidator.html#safe_library_path%3F-class_method" title="TreeHaver::PathValidator.safe_library_path? (method)">PathValidator.safe_library_path?</a></span><br />
to prevent path traversal and other attacks. Invalid ENV paths cause<br />
an error to be raised (Principle of Least Surprise - explicit paths must work).</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>Setting the ENV variable to an empty string explicitly disables<br />
this grammar. This allows fallback to alternative backends (e.g., Citrus).</p>
</div>
  </div>

<p>Find the grammar library path</p>

<p>Searches in order:</p>
<ol>
  <li>Environment variable override (validated for safety)</li>
  <li>Extra paths provided at initialization</li>
  <li>Common system installation paths</li>
</ol>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the path to the library, or nil if not found</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="NotAvailable.html" title="TreeHaver::NotAvailable (class)">TreeHaver::NotAvailable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if ENV variable is set to an invalid path</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#find_library_path_safe-instance_method" title="TreeHaver::GrammarFinder#find_library_path_safe (method)">For stricter validation (trusted directories only)</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_library_path'>find_library_path</span>
  <span class='comment'># Check environment variable first (highest priority)
</span>  <span class='comment'># Use key? to distinguish between &quot;not set&quot; and &quot;set to empty&quot;
</span>  <span class='kw'>if</span> <span class='const'>ENV</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_env_path'>env_path</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='rbracket'>]</span>

    <span class='comment'># :nocov: defensive - ENV.key? true with nil value is rare edge case
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_env_path'>env_path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@env_rejection_reason</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>explicitly disabled (set to nil)</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='comment'># :nocov:
</span>
    <span class='comment'># Empty string means &quot;explicitly skip this grammar&quot;
</span>    <span class='comment'># This allows users to disable tree-sitter for specific languages
</span>    <span class='comment'># and fall back to alternative backends like Citrus
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_env_path'>env_path</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='ivar'>@env_rejection_reason</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>explicitly disabled (set to empty string)</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='comment'># Store why env path was rejected for better error messages
</span>    <span class='ivar'>@env_rejection_reason</span> <span class='op'>=</span> <span class='id identifier rubyid_validate_env_path'>validate_env_path</span><span class='lparen'>(</span><span class='id identifier rubyid_env_path'>env_path</span><span class='rparen'>)</span>

    <span class='comment'># Principle of Least Surprise: If user explicitly sets an ENV variable
</span>    <span class='comment'># to a path, that path MUST work. Don&#39;t silently fall back to auto-discovery.
</span>    <span class='kw'>if</span> <span class='ivar'>@env_rejection_reason</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="NotAvailable.html" title="TreeHaver::NotAvailable (class)">NotAvailable</a></span></span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is set to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_path'>env_path</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> but </span><span class='embexpr_beg'>#{</span><span class='ivar'>@env_rejection_reason</span><span class='embexpr_end'>}</span><span class='tstring_content'>. </span><span class='tstring_end'>&quot;</span></span> \
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Either fix the path, unset the variable to use auto-discovery, </span><span class='tstring_end'>&quot;</span></span> \
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>or set it to empty string to explicitly disable this grammar.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_env_path'>env_path</span>
  <span class='kw'>end</span>

  <span class='comment'># Search all paths (these are constructed from trusted base dirs)
</span>  <span class='id identifier rubyid_search_paths'>search_paths</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='op'>|</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_library_path_safe-instance_method">
  
    #<strong>find_library_path_safe</strong>  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Find the grammar library path with strict security validation</p>

<p>This method only returns paths that are in trusted system directories.<br />
Use this when you want maximum security and don’t need to support<br />
custom installation locations.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the path to the library, or nil if not found</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>For the list of trusted directories</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


216
217
218
219
220
221</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 216</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_library_path_safe'>find_library_path_safe</span>
  <span class='comment'># Environment variable is NOT checked in safe mode - only trusted system paths
</span>  <span class='id identifier rubyid_search_paths'>search_paths</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="PathValidator.html" title="TreeHaver::PathValidator (module)">PathValidator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_in_trusted_directory?'><span class='object_link'><a href="PathValidator.html#in_trusted_directory%3F-class_method" title="TreeHaver::PathValidator.in_trusted_directory? (method)">in_trusted_directory?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="library_filename-instance_method">
  
    #<strong>library_filename</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get the library filename for the current platform</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the library filename (e.g., “libtree-sitter-toml.so”)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_library_filename'>library_filename</span>
  <span class='id identifier rubyid_ext'>ext</span> <span class='op'>=</span> <span class='id identifier rubyid_platform_extension'>platform_extension</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>libtree-sitter-</span><span class='embexpr_beg'>#{</span><span class='ivar'>@language_name</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ext'>ext</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="not_found_message-instance_method">
  
    #<strong>not_found_message</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get a human-readable error message when library is not found</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>error message with installation hints</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 339</span>

<span class='kw'>def</span> <span class='id identifier rubyid_not_found_message'>not_found_message</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tree-sitter </span><span class='embexpr_beg'>#{</span><span class='ivar'>@language_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> grammar not found.</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Check if env var is set but rejected
</span>  <span class='id identifier rubyid_env_value'>env_value</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>+=</span> <span class='kw'>if</span> <span class='id identifier rubyid_env_value'>env_value</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@env_rejection_reason</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is set to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_value'>env_value</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> but </span><span class='embexpr_beg'>#{</span><span class='ivar'>@env_rejection_reason</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_env_value'>env_value</span> <span class='op'>&amp;&amp;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_env_value'>env_value</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_tree_sitter_runtime_usable?'>tree_sitter_runtime_usable?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is set and file exists, but no tree-sitter runtime is available. </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Add ruby_tree_sitter, ffi, or tree_stump gem to your Gemfile.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_env_value'>env_value</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is set but was not used (file may have been removed).</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> Searched: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_search_paths'>search_paths</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> Install tree-sitter-</span><span class='embexpr_beg'>#{</span><span class='ivar'>@language_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> or set </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> to a valid path.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register!-instance_method">
  
    #<strong>register!</strong>(raise_on_missing: false)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Register this language with TreeHaver</p>

<p>After registration, the language can be loaded via dynamic method<br />
(e.g., <code>TreeHaver::Language.toml</code>).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>raise_on_missing</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>if true, raises when library not found</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if registration succeeded</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="NotAvailable.html" title="TreeHaver::NotAvailable (class)">NotAvailable</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if library not found and raise_on_missing is true</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


305
306
307
308
309
310
311
312
313
314
315
316</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 305</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register!'>register!</span><span class='lparen'>(</span><span class='label'>raise_on_missing:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_find_library_path'>find_library_path</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_path'>path</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_raise_on_missing'>raise_on_missing</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="NotAvailable.html" title="TreeHaver::NotAvailable (class)">NotAvailable</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_not_found_message'>not_found_message</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='const'><span class='object_link'><a href="../TreeHaver.html" title="TreeHaver (module)">TreeHaver</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register_language'><span class='object_link'><a href="../TreeHaver.html#register_language-class_method" title="TreeHaver.register_language (method)">register_language</a></span></span><span class='lparen'>(</span><span class='ivar'>@language_name</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>symbol:</span> <span class='id identifier rubyid_symbol_name'>symbol_name</span><span class='rparen'>)</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="search_info-instance_method">
  
    #<strong>search_info</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get debug information about the search</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>diagnostic information</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


321
322
323
324
325
326
327
328
329
330
331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 321</span>

<span class='kw'>def</span> <span class='id identifier rubyid_search_info'>search_info</span>
  <span class='id identifier rubyid_found'>found</span> <span class='op'>=</span> <span class='id identifier rubyid_find_library_path'>find_library_path</span> <span class='comment'># This populates @env_rejection_reason
</span>  <span class='lbrace'>{</span>
    <span class='label'>language:</span> <span class='ivar'>@language_name</span><span class='comma'>,</span>
    <span class='label'>env_var:</span> <span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='comma'>,</span>
    <span class='label'>env_value:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='id identifier rubyid_env_var_name'>env_var_name</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>env_rejection_reason:</span> <span class='ivar'>@env_rejection_reason</span><span class='comma'>,</span>
    <span class='label'>symbol:</span> <span class='id identifier rubyid_symbol_name'>symbol_name</span><span class='comma'>,</span>
    <span class='label'>library_filename:</span> <span class='id identifier rubyid_library_filename'>library_filename</span><span class='comma'>,</span>
    <span class='label'>search_paths:</span> <span class='id identifier rubyid_search_paths'>search_paths</span><span class='comma'>,</span>
    <span class='label'>found_path:</span> <span class='id identifier rubyid_found'>found</span><span class='comma'>,</span>
    <span class='label'>available:</span> <span class='op'>!</span><span class='id identifier rubyid_found'>found</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="search_paths-instance_method">
  
    #<strong>search_paths</strong>  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Generate the full list of search paths for this language</p>

<p>Order: ENV override, extra_paths, then common system paths</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>all paths to search</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120
121
122
123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 114</span>

<span class='kw'>def</span> <span class='id identifier rubyid_search_paths'>search_paths</span>
  <span class='id identifier rubyid_paths'>paths</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='comment'># Extra paths provided at initialization (searched after ENV)
</span>  <span class='ivar'>@extra_paths</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dir'>dir</span><span class='op'>|</span>
    <span class='id identifier rubyid_paths'>paths</span> <span class='op'>&lt;&lt;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_library_filename'>library_filename</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Common system paths with platform-appropriate extension
</span>  <span class='const'><span class='object_link'><a href="#BASE_SEARCH_DIRS-constant" title="TreeHaver::GrammarFinder::BASE_SEARCH_DIRS (constant)">BASE_SEARCH_DIRS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dir'>dir</span><span class='op'>|</span>
    <span class='id identifier rubyid_paths'>paths</span> <span class='op'>&lt;&lt;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_library_filename'>library_filename</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_paths'>paths</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="symbol_name-instance_method">
  
    #<strong>symbol_name</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get the expected symbol name exported by the grammar library</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the symbol name (e.g., “tree_sitter_toml”)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 97</span>

<span class='kw'>def</span> <span class='id identifier rubyid_symbol_name'>symbol_name</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tree_sitter_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@language_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_env_path-instance_method">
  
    #<strong>validate_env_path</strong>(path)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Validate an environment variable path and return reason if invalid</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>rejection reason or nil if valid</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/tree_haver/grammar_finder.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_env_path'>validate_env_path</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='comment'># Check for leading/trailing whitespace
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span> <span class='op'>!=</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>contains leading or trailing whitespace (use </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Check if path is safe
</span>  <span class='kw'>unless</span> <span class='const'><span class='object_link'><a href="PathValidator.html" title="TreeHaver::PathValidator (module)">PathValidator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_safe_library_path?'><span class='object_link'><a href="PathValidator.html#safe_library_path%3F-class_method" title="TreeHaver::PathValidator.safe_library_path? (method)">safe_library_path?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed security validation (may contain path traversal or suspicious characters)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Check if file exists
</span>  <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file does not exist</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span> <span class='comment'># Valid!
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jan  6 04:46:44 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.0).
</div>

    </div>
  </body>
</html>